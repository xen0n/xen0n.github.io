<!doctype html><html lang=zh-cmn-hans-cn dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>关于 LoongArch 的常见问题解答 | write(2)</title>
<meta name=keywords content>
<meta name=description content="前言 自从 2021 年 LoongArch 架构官宣以来，这个架构获得了与其年龄和市场规模不成比例的关注（此处为褒义）。 但与国内外社会舆论、世界开源社区的热情相对比之下，">
<meta name=author content="WÁNG &#34;xen0n&#34; Xuěruì">
<link rel=canonical href=https://blog.xen0n.name/posts/tinkering/loongarch-faq/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.xen0n.name/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.xen0n.name/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.xen0n.name/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.xen0n.name/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.xen0n.name/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.2">
<link rel=alternate hreflang=zh-cmn-hans-cn href=https://blog.xen0n.name/posts/tinkering/loongarch-faq/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="关于 LoongArch 的常见问题解答">
<meta property="og:description" content="前言 自从 2021 年 LoongArch 架构官宣以来，这个架构获得了与其年龄和市场规模不成比例的关注（此处为褒义）。 但与国内外社会舆论、世界开源社区的热情相对比之下，">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.xen0n.name/posts/tinkering/loongarch-faq/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-12T14:55:00+08:00">
<meta property="article:modified_time" content="2022-02-12T14:55:00+08:00"><meta property="og:site_name" content="write(2)">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="关于 LoongArch 的常见问题解答">
<meta name=twitter:description content="前言 自从 2021 年 LoongArch 架构官宣以来，这个架构获得了与其年龄和市场规模不成比例的关注（此处为褒义）。 但与国内外社会舆论、世界开源社区的热情相对比之下，">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.xen0n.name/posts/"},{"@type":"ListItem","position":2,"name":"关于 LoongArch 的常见问题解答","item":"https://blog.xen0n.name/posts/tinkering/loongarch-faq/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"关于 LoongArch 的常见问题解答","name":"关于 LoongArch 的常见问题解答","description":"前言 自从 2021 年 LoongArch 架构官宣以来，这个架构获得了与其年龄和市场规模不成比例的关注（此处为褒义）。 但与国内外社会舆论、世界开源社区的热情相对比之下，","keywords":[],"articleBody":"前言 自从 2021 年 LoongArch 架构官宣以来，这个架构获得了与其年龄和市场规模不成比例的关注（此处为褒义）。 但与国内外社会舆论、世界开源社区的热情相对比之下，这个架构的网上公开信息却大部分来自龙芯公司的公关宣传稿； 这可能对主要工作是开会、签字、画饼、圈钱的那些人已经足够了，但对那些要干活的广大开发者却远远不够。\n本文就争取做这么一篇讲述客观事实，对开发者有用的 FAQ 文档。 由于涉及商业利益的事物不可避免存在争议，本文也力争将多方观点同时整理、平等呈现。\n本文内容会不定期更新，所有更新内容都会注明更新日期。您当前看到的版本是 2022-02-12 更新的。\n免责说明：除观点性质的文字之外，本文中体现的信息均取自公开资料。观点性质的文字总会被明确标注出来。 这些观点性质的文字仅代表个人观点，与本人雇主、龙芯公司等实体均无关。 本人与龙芯生态、MIPS 生态的任何企业均无关联。\n更新记录  2022-02-12: 最初版本。  关于指令集 LoongArch 是什么？中文名叫啥？  龙芯架构 LoongArch 是一种精简指令集计算机（Reduced Instruction Set Computing，简称 RISC）风格的指令系统架构。\n——《龙芯架构参考手册》卷一：基础架构，引言\n LoongArch 是龙芯公司设计的一种 CPU 指令集架构，2020 年对外公开其存在，2021 年起公开出货，在其 3A5000 CPU 产品开始搭载。\n根据 LoongArch 的参考手册标题以及手册的第一句（引文即为此），LoongArch 的中文名应为“龙芯架构”。\nLoongArch 有 logo 吗？ 根据现有资料，没有；注册商标的图样是纯文本。\n其实比较奇怪，因为一个好的 logo 显然有助于品牌传播。希望 2022 年可以看到一个！\nLoongArch 这个单词的词源是啥，怎么发音？ （注意：此处使用的英语为美式发音。）\n显然，该单词是“龙芯”（Loongson）、“Architecture”两个单词的混成词（portmanteau，也叫“混合词”、“合音词”等等）。\n介于此，LoongArch 发音也应当是“龙芯”和“Architecture”两词的混合，即 /ˈlʊŋ˧˥/ + /ɑɹk/ = /ˈlʊŋ˧˥ˌɑɹk/（读若“龙Arch”；中式英语发音 lóng à ke，“龙啊（四声）克”）。\n当然，实践中“Arch”可能也被直接拼读为/ɑɹt͡ʃ/（作“拱门”解的 arch 一词），其原因与“char”经常不被念为“car”类似。这也是可接受的读音。（中式英语发音 lóng à qu，“龙啊去”） 😏\nLoongArch 作为一个指令集的基本特征如何？ LoongArch 是一门：\n 支持 32 位、64 位操作的， 仅支持小端（Little-endian）字节序的， 指令字定长 32 位的， 寄存器-寄存器架构。  其他一些可通过观察得到的结论：\nLoongArch 的操作码全部从最高位向低位延伸，也就是“前缀编码”。 这有助于节约指令字空间。当然，这意味着 LoongArch 表面上没有明确的“操作码”字段，虽然每个指令的高 6 位也是相当能体现指令功能分类的，仅此而已。\nLoongArch 是相当经典的 RISC 架构。 32 个寄存器，0 号寄存器固定表示零，目标寄存器可以不是源寄存器之一，运算操作不访存，内存模型平坦，等等。\nLoongArch 的一些操作比 MIPS 和 RISC-V 更带劲。 跳转指令和 PIC 相关操作的立即数非常宽；装载立即数至多需要 4 条指令不需要移位；ABI 甚至给未来保留了一个静态寄存器（callee-save register）剩下的也差不多够用。\n基本操作的宽度定义 在基本操作的宽度定义上，LoongArch 遵循传统架构（如 x86、MIPS）做法：对于多数操作而言，某个特定操作码的宽度不随微架构、当前机器模式确定的寄存器宽度而改变。例如，使用 add.d 操作码的指令要么在当前模式或处理器核上非法，要么永远代表 64 位加法。\n注意这与 RISC-V 的做法不同：仍以加法操作为例，RISC-V 的 add 指令总是操作 XLEN 宽度，在 RV32 核上操作 32 位宽，在 RV64 核上就操作 64 位了。相应地，RV64 新增的 addw 指令只操作低 32 位，而这条指令在 RV32 不存在。\nLA464 处理器核/微架构和 GS464V 是不是一个东西，为啥改名了？ 本回答含有猜测成分。\n首先需要明确一点，龙芯公司对其微架构/处理器核的命名似乎没有特别的讲究。 例如，3A4000 处理器包含 4 个 GS464V 核，但几年前的 3B1500 处理器，在文档上它的核也叫 GS464V。 （维基百科上有 GS464EV 的说法，这就是社区为了解除歧义而不得不生造的名字。）\n在网上一些较早的公开发表文章和讲演中，主要是一些讲述 3A5000 和 LoongArch 开发过程的内容，可以看到 “调整现有 IP 核的指令系统”等类似的文字。考虑到 3A4000 到 3A5000 是一个 tock-tick 周期， 这似乎意味着 3A4000 换掉译码器就约等于 3A5000。 然而事实上指令集已经不兼容了，共用一个代号终归不好；龙芯公司最终还是在 2021 年 8 月份修改了所有手册与开源代码， 将 GS464V 批量替换为 LA464。\n整体上看，LA464 和 GS464V 应该还是理解为大体相同的微架构，但支持指令集不同的一对不太相似的“双胞胎”为好。\nLoongArch 和 MIPS 有什么关系？ （请注意：由于所做的事情都是“通用计算”这一件事，所有 RISC 架构都存在相当程度的相似性。）\n按照公开资料，LoongArch 与 MIPS 不存在互操作性，并且一些关键架构特性也不能做到 1:1 对应。\n LoongArch 指令编码与 MIPS 完全不同。 LoongArch 不存在跳转延迟槽（branch delay slots），而 MIPS 直到 R6 才增加了可选使用的无延迟槽跳转指令。 LoongArch 去掉了 MIPS 上的一部分历史包袱，例如神奇的 HI/LO 累加器。 LoongArch 的 ABI 完全离开 MIPS 传统，而基于 RISC-V ABI 定义。分立的返回值寄存器、内核专用寄存器等概念都被摈弃。  但客观上从 LoongArch 上确实可以看到明显的 MIPS 影响，例如：\n LoongArch 特权架构部分与 MIPS 有所相似（例如 TLB 的奇偶页设计，麻烦，不见于其他架构，但 LoongArch 这么做了）。 个别一些指令（如 maskeqz/masknez）与 MIPS R6 对应指令（selnez/seleqz）语义相同，且不见于其他架构。 个别一些操作（如 64 位立即数的装载，分四段，官方指令名为 lu12i.w/ori/lu32i.d/lu52i.d）与 MIPS R6 类似（lui/ori/ahi/ati），仅细节不同（每段的宽度，LoongArch 12/20/20/12 vs MIPS R6 16/16/16/16）；此做法不见于其他架构。 虚拟化扩展（Loongson Virtualization Extension）的缩写叫 LVZ，非常可疑。因为按照 Loongson SIMD Extension = LSX，Loongson Advanced SIMD Extension = LASX，Loongson Binary Translation Extension = LBT（不对称：没叫 LBTX）的规律，这个扩展应该缩写叫 LVX 或者 LV，无论如何不可能从第二个单词取出两个字母变成 LVZ。VZ 是 MIPS 的叫法！  LoongArch 和 RISC-V 有什么关系？ （请注意：由于所做的事情都是“通用计算”这一件事，所有 RISC 架构都存在相当程度的相似性。）\n按照公开资料，LoongArch 与 RISC-V 不存在互操作性，虽然许多指令在一定条件下（如限定 64 位操作）可以做到 1:1 对应。\n LoongArch 特权架构、内存管理与 RISC-V 相当不同。 LoongArch 基础指令集支持的操作基本是 RISC-V 相应部分的超集。 RISC-V 的带立即数指令，立即数总是做符号扩展，而 LoongArch 有区分（算术操作做符号扩展，逻辑操作做零扩展）。  在 LoongArch 的软件部分，如 ABI 和一些基础工具链组件，可以明显看到 RISC-V 的影响。 LoongArch ABI 与 RISC-V ABI 相当相似，且指令语义相似度也高，在进行基础软件移植时，对 RISC-V 汇编代码经常只需做简单语法层面调整即可正确完成 LoongArch 版的相应操作。\nLoongArch 的一些指令与对应的 RISC-V 指令语义完全相同，一些架构特性也类似。如：\n PIC 操作指令 pcaddu12i 与 RISC-V auipc 语义相同。 寄存器跳转指令 jirl 与 RISC-V jalr 语义相同，而与 MIPS jalr 非常不同。 计时指令 rdtime.* 与 RISC-V 相应指令语义类似，都基于恒定频率计时器。 LoongArch（实际从前身 3A4000 就开始了）特权资源位于 CSR 空间，CSR 概念显然来自 RISC-V。 RISC-V 最早有四层权限（从高到低 Machine/Hypervisor/Supervisor/User，后来 Hypervisor 被移除），LoongArch 也定义了四层（从高到低 PLV0/PLV1/PLV2/PLV3）。但 LoongArch 操作系统跑在 PLV0 最高级，而 RISC-V 操作系统建议是跑在 Supervisor 级别。  这些也可能是 RISC-V 对 LoongArch 的影响体现。\nLoongArch 有哪些 ABI？ 按照龙芯架构 ELF psABI 文档，LoongArch 目前定义了 3x2=6 种 ABI。\n其中数据模型为：\n ILP32（int、long、指针都为 32 位宽，是 32 位但不彻底排斥 64 位操作的模型） LP64（long 及更宽的类型与指针为 64 位宽，是 Linux 世界通行的 64 位数据模型）  浮点支持为：\n 软浮点（S） 单精度（F） 双精度（D）  目前只有 LP64D 一种 ABI 有完整的支持。目前市面上已公开的商业发行版只使用这一种 ABI 构建。 如果您尝试使用其他 ABI，有极大可能会遇到各种编译错误，不建议在生态建设的早期使用。 特别地，ILP32 系列 ABI 的支持非常不完整，如果尝试使用，大概率会直接报错。\nLoongArch 的向量扩展是怎么一回事？ 由于相关文档没有开放，以下内容是猜测。\nMIPS 时代末期的龙芯 3A4000 实现的是完整的 MIPS MSA 向量扩展。 除此之外，3A4000 还支持从 2F 时代继承的 LoongMMI，以及从未在公开文档出现的 LSX/LASX。 梳理这些向量支持：\n MSA：根据 MSA64 手册 v1.12 的描述，是 128 位固定向量宽度。 LoongMMI：用法极度类似 x86 MMX，64 位固定向量宽度。 LSX/LASX：除 PPT 之外公开资料近似不存在，工具链源码短暂出现后被撤回。LSX 应该是 128 位固定向量宽度，LASX 则为 256 位固定向量宽度。  可见所有这些向量支持都是固定宽度的。结合《龙芯架构参考手册》卷一 表 2-2“CPUCFG 访问配置信息列表”对 LSX、LASX 位的描述（“128 位向量扩展”、“256 位向量扩展”），可以推测 LoongArch 的 LSX/LASX 和 MIPS 时代的 LSX/LASX 应该是近似的东西，至少向量宽度也是固定的。 指令编码必然改变了，也可能有些指令被增删或修改，毕竟没有公开文档和开源支持，外界不会有代码依赖这些指令，也就不需要考虑兼容性。\n注意到近年新兴的向量扩展，如 AArch64 的 SVE 与 RISC-V 的 RVV 都是变长向量，支持软件在运行时动态配置向量单元使其操作宽度适应软件需求，也意味着硬件升级不需要相应修改软件即可透明地利用更宽的硬件资源，是一个较好的趋势。 我们在龙芯的 glibc 代码库中，注意到了提前为变长向量做准备的变更。 考虑到 LSX/LASX 迟迟未能公布可能有多方面原因（尤其不能排除知识产权问题），这或许意味着 LSX/LASX 将永远不会公开，而在将来的某个时间点会有类似 RVV 的向量指令替代 LSX/LASX 供世界使用。\nLoongArch 的二进制翻译扩展是怎么一回事？ 由于相关文档没有开放，以下内容是猜测。\n与向量扩展的情况类似，我们可以参考 MIPS 时代龙芯的二进制翻译扩展来推测 LoongArch 的相应情况。 虽然公开渠道没有指令编码和内核支持，但这个扩展在一些学术汇报、乃至龙芯自己做的展示中已经初见端倪：\n 新增了架构状态 EFLAGS 寄存器，为一些基础指令新增只按照相应语义更新 EFLAGS 的对应指令 新增了架构状态 TOP 寄存器，以及对应的 FPU 模式位，在 x87 模式下，改变浮点操作寄存器字段的语义，使其变为基于 TOP 的寻址方式  后来又添加了 ARM 条件执行等操作的支持，想必也是类似的实现思路。那么 LoongArch 的 x86、ARM 二进制翻译大概率也是先前二进制翻译扩展的微调；至于 MIPS 二进制翻译，由于同属经典 RISC 架构， 可能唯一的硬件支持会是跳转延迟槽。（HI/LO 等其他一些奇葩 MIPS 特性可以在翻译阶段由软件轻易完成，反正也要重建数据流。）\n关于开发 我准备移植我的软件到 LoongArch，有什么需要准备的吗？ 您不需要特别准备！\nLoongArch 生态建设的预期是成为一个“正常”的软硬件平台。 您怎么为其他平台（如 x86、ARM）做开发，除了那些本质上就与平台相关的事情之外，在 LoongArch 上您就怎么做。\n如果您使用高级语言进行具体领域的业务研发，您大体上总是不需要关注平台底层的技术细节。 这些事情已经主要由开源社区（包括全世界使用龙芯的企业和个人开发者）完成了。\n如果您本身即是基础软件的开发者，或者属于需要偶尔关注底层技术细节的上层开发者， 龙芯公司提供的龙芯架构文档是很好的出发点。\n我用 C/C++ 语言，怎么写 CFLAGS？怎么针对 LoongArch 及其基础特性做条件编译？ 请参阅《龙芯架构工具链约定》。\n我没有 LoongArch 硬件，我的软件该怎么测试？ 大部分情况下，您可以使用 QEMU 完成测试。 系统级模拟（模拟一台完整的龙芯架构计算机）与用户态模拟（将当前系统的内核模拟为龙芯架构）均可以支持。 QEMU 的使用方法不属于本文范畴，请参考其他在线资料。\n注：截至 2022-02-12，LoongArch 的 target 支持没有合入 QEMU 主线，这意味着您需要自行编译龙芯的开发分支。\n关于生态 有哪些 Linux 发行版提供 LoongArch 支持了？ 得益于龙芯公司优先提供的硬件与团队协作等资源，LoongArch 的商业生态建设非常迅速。\n截至 2022-02-12，已有多种（中国大陆境内的）商业 Linux 发行版提供了 LoongArch port，包括但不限于以下的发行版（按字母顺序排列）：\n Kylin（麒麟） Loongnix（龙芯中科） UOS（统信）  在 LoongArch 指令集手册等文档发布、以及工具链等基础软件的分支（fork）开源后，社区发行版也加快了移植的脚步。 截至 2022-02-12 已经出现了以下的发行版移植项目（包括但不限于，字母顺序排列）：\n Arch Linux CLFS Gentoo  为什么我不能在社区发行版上运行 WPS Office 等软件？（“旧世界”“新世界”是怎么一回事？） 截至 2022-02-12，所有商业发行版与所有社区发行版互不兼容。 社区发行版上构建的所有二进制软件，以及部分以源码、字节码形式存在的高级语言软件（如 Python、Java 写作的软件）不能在商业发行版上运行，反之亦然。 目前第三方软件开发商提供的闭源软件（如 WPS Office 等）都是在商业发行版上构建的，在社区发行版上有极大的概率不能工作。\n这个情况一般被称作 “新旧世界”的兼容问题。目前所有商业发行版都属于旧世界，所有社区发行版都属于新世界。两个世界在未来会得到统一，但目前可以被视作两个平行宇宙。\n至于为何会出现两个世界，以及有哪些方法可以做到兼容，就说来话长了 ;-) 所有细节会在不久后的另一篇文章中专门讲述。\n市面上有哪些 LoongArch 硬件可以买到？ 虽然龙芯产品的国际购买渠道自从 2F 时代之后就已基本不复存在，但至少在中国大陆地区，已经有多种搭载 LoongArch CPU 的产品可以在公开渠道方便地买到。 例如，龙芯 3A5000 有 ATX 主板、整机、笔记本形态的产品，3C5000L 有机架式服务器形态的产品。\n由于涉及商业，本文不便提供任何具体的购买渠道或链接，但您总可以自行在某宝、某东、某鱼等平台上搜索“龙芯”关键词。\n注意：由于目前龙芯产品产量较小，无法靠规模效应摊薄成本，这些产品会比各项指标近似的 x86、ARM 等“主流”产品贵上许多。加之生态建设早期会有许多基础性的问题亟待解决，因此 不建议只想买来使用的非开发者用户冲动购买。\n怎么认识其他 LoongArch 同好？ 所有技术都有交流社区，LoongArch 当然不例外。网上有许多地方都可以讨论龙芯、LoongArch 等等相关话题，人多的公开场合包括但不限于：\n 龙芯开源社区论坛（由于技术原因，目前不支持 HTTPS）（仅中文交流） 百度贴吧龙芯吧（仅中文交流） Telegram Loongson group（中文 \u0026 English）  有一些龙芯话题的 QQ 群，但由于本文作者不使用 QQ，因此不知道群号。（欢迎知道的朋友给作者私聊或者提 PR 补充！）\n注：这些公开场合相比技术交流更适合灌水。 由于围绕龙芯有一群观念较为极端的最终用户粉丝，就事论事的技术交流万一涉及一些敏感话题点，在以上公开场合不一定会有效率。 但如果您具备相应的技术交流态度、技能，您应该自己也能找到开发者的交流场所，因此此处就暂时不提供了 ;-)\n","wordCount":"5983","inLanguage":"zh-cmn-hans-cn","datePublished":"2022-02-12T14:55:00+08:00","dateModified":"2022-02-12T14:55:00+08:00","author":[{"@type":"Person","name":"WÁNG \"xen0n\" Xuěruì"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.xen0n.name/posts/tinkering/loongarch-faq/"},"publisher":{"@type":"Organization","name":"write(2)","logo":{"@type":"ImageObject","url":"https://blog.xen0n.name/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.xen0n.name/ accesskey=h title="write(2) (Alt + H)">write(2)</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://blog.xen0n.name/en/ title="English (US)" aria-label=:us:>🇺🇸</a>
</li>
</ul>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.xen0n.name/archives title=所有文章>
<span>所有文章</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://blog.xen0n.name/>Home</a>&nbsp;»&nbsp;<a href=https://blog.xen0n.name/posts/>Posts</a></div>
<h1 class=post-title>
关于 LoongArch 的常见问题解答
</h1>
<div class=post-meta><span title="2022-02-12 14:55:00 +0800 +0800">2022/02/12</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;WÁNG "xen0n" Xuěruì
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li>
<li>
<a href=#%e6%9b%b4%e6%96%b0%e8%ae%b0%e5%bd%95 aria-label=更新记录>更新记录</a></li>
<li>
<a href=#%e5%85%b3%e4%ba%8e%e6%8c%87%e4%bb%a4%e9%9b%86 aria-label=关于指令集>关于指令集</a><ul>
<li>
<a href=#loongarch-%e6%98%af%e4%bb%80%e4%b9%88%e4%b8%ad%e6%96%87%e5%90%8d%e5%8f%ab%e5%95%a5 aria-label="LoongArch 是什么？中文名叫啥？">LoongArch 是什么？中文名叫啥？</a></li>
<li>
<a href=#loongarch-%e6%9c%89-logo-%e5%90%97 aria-label="LoongArch 有 logo 吗？">LoongArch 有 logo 吗？</a></li>
<li>
<a href=#loongarch-%e8%bf%99%e4%b8%aa%e5%8d%95%e8%af%8d%e7%9a%84%e8%af%8d%e6%ba%90%e6%98%af%e5%95%a5%e6%80%8e%e4%b9%88%e5%8f%91%e9%9f%b3 aria-label="LoongArch 这个单词的词源是啥，怎么发音？">LoongArch 这个单词的词源是啥，怎么发音？</a></li>
<li>
<a href=#loongarch-%e4%bd%9c%e4%b8%ba%e4%b8%80%e4%b8%aa%e6%8c%87%e4%bb%a4%e9%9b%86%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%89%b9%e5%be%81%e5%a6%82%e4%bd%95 aria-label="LoongArch 作为一个指令集的基本特征如何？">LoongArch 作为一个指令集的基本特征如何？</a><ul>
<li>
<a href=#%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c%e7%9a%84%e5%ae%bd%e5%ba%a6%e5%ae%9a%e4%b9%89 aria-label=基本操作的宽度定义>基本操作的宽度定义</a></li></ul>
</li>
<li>
<a href=#la464-%e5%a4%84%e7%90%86%e5%99%a8%e6%a0%b8%e5%be%ae%e6%9e%b6%e6%9e%84%e5%92%8c-gs464v-%e6%98%af%e4%b8%8d%e6%98%af%e4%b8%80%e4%b8%aa%e4%b8%9c%e8%a5%bf%e4%b8%ba%e5%95%a5%e6%94%b9%e5%90%8d%e4%ba%86 aria-label="LA464 处理器核/微架构和 GS464V 是不是一个东西，为啥改名了？">LA464 处理器核/微架构和 GS464V 是不是一个东西，为啥改名了？</a></li>
<li>
<a href=#loongarch-%e5%92%8c-mips-%e6%9c%89%e4%bb%80%e4%b9%88%e5%85%b3%e7%b3%bb aria-label="LoongArch 和 MIPS 有什么关系？">LoongArch 和 MIPS 有什么关系？</a></li>
<li>
<a href=#loongarch-%e5%92%8c-risc-v-%e6%9c%89%e4%bb%80%e4%b9%88%e5%85%b3%e7%b3%bb aria-label="LoongArch 和 RISC-V 有什么关系？">LoongArch 和 RISC-V 有什么关系？</a></li>
<li>
<a href=#loongarch-%e6%9c%89%e5%93%aa%e4%ba%9b-abi aria-label="LoongArch 有哪些 ABI？">LoongArch 有哪些 ABI？</a></li>
<li>
<a href=#loongarch-%e7%9a%84%e5%90%91%e9%87%8f%e6%89%a9%e5%b1%95%e6%98%af%e6%80%8e%e4%b9%88%e4%b8%80%e5%9b%9e%e4%ba%8b aria-label="LoongArch 的向量扩展是怎么一回事？">LoongArch 的向量扩展是怎么一回事？</a></li>
<li>
<a href=#loongarch-%e7%9a%84%e4%ba%8c%e8%bf%9b%e5%88%b6%e7%bf%bb%e8%af%91%e6%89%a9%e5%b1%95%e6%98%af%e6%80%8e%e4%b9%88%e4%b8%80%e5%9b%9e%e4%ba%8b aria-label="LoongArch 的二进制翻译扩展是怎么一回事？">LoongArch 的二进制翻译扩展是怎么一回事？</a></li></ul>
</li>
<li>
<a href=#%e5%85%b3%e4%ba%8e%e5%bc%80%e5%8f%91 aria-label=关于开发>关于开发</a><ul>
<li>
<a href=#%e6%88%91%e5%87%86%e5%a4%87%e7%a7%bb%e6%a4%8d%e6%88%91%e7%9a%84%e8%bd%af%e4%bb%b6%e5%88%b0-loongarch%e6%9c%89%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e5%87%86%e5%a4%87%e7%9a%84%e5%90%97 aria-label="我准备移植我的软件到 LoongArch，有什么需要准备的吗？">我准备移植我的软件到 LoongArch，有什么需要准备的吗？</a></li>
<li>
<a href=#%e6%88%91%e7%94%a8-cc-%e8%af%ad%e8%a8%80%e6%80%8e%e4%b9%88%e5%86%99-cflags%e6%80%8e%e4%b9%88%e9%92%88%e5%af%b9-loongarch-%e5%8f%8a%e5%85%b6%e5%9f%ba%e7%a1%80%e7%89%b9%e6%80%a7%e5%81%9a%e6%9d%a1%e4%bb%b6%e7%bc%96%e8%af%91 aria-label="我用 C/C++ 语言，怎么写 CFLAGS？怎么针对 LoongArch 及其基础特性做条件编译？">我用 C/C++ 语言，怎么写 CFLAGS？怎么针对 LoongArch 及其基础特性做条件编译？</a></li>
<li>
<a href=#%e6%88%91%e6%b2%a1%e6%9c%89-loongarch-%e7%a1%ac%e4%bb%b6%e6%88%91%e7%9a%84%e8%bd%af%e4%bb%b6%e8%af%a5%e6%80%8e%e4%b9%88%e6%b5%8b%e8%af%95 aria-label="我没有 LoongArch 硬件，我的软件该怎么测试？">我没有 LoongArch 硬件，我的软件该怎么测试？</a></li></ul>
</li>
<li>
<a href=#%e5%85%b3%e4%ba%8e%e7%94%9f%e6%80%81 aria-label=关于生态>关于生态</a><ul>
<li>
<a href=#%e6%9c%89%e5%93%aa%e4%ba%9b-linux-%e5%8f%91%e8%a1%8c%e7%89%88%e6%8f%90%e4%be%9b-loongarch-%e6%94%af%e6%8c%81%e4%ba%86 aria-label="有哪些 Linux 发行版提供 LoongArch 支持了？">有哪些 Linux 发行版提供 LoongArch 支持了？</a></li>
<li>
<a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%88%91%e4%b8%8d%e8%83%bd%e5%9c%a8%e7%a4%be%e5%8c%ba%e5%8f%91%e8%a1%8c%e7%89%88%e4%b8%8a%e8%bf%90%e8%a1%8c-wps-office-%e7%ad%89%e8%bd%af%e4%bb%b6%e6%97%a7%e4%b8%96%e7%95%8c%e6%96%b0%e4%b8%96%e7%95%8c%e6%98%af%e6%80%8e%e4%b9%88%e4%b8%80%e5%9b%9e%e4%ba%8b aria-label="为什么我不能在社区发行版上运行 WPS Office 等软件？（“旧世界”“新世界”是怎么一回事？）">为什么我不能在社区发行版上运行 WPS Office 等软件？（“旧世界”“新世界”是怎么一回事？）</a></li>
<li>
<a href=#%e5%b8%82%e9%9d%a2%e4%b8%8a%e6%9c%89%e5%93%aa%e4%ba%9b-loongarch-%e7%a1%ac%e4%bb%b6%e5%8f%af%e4%bb%a5%e4%b9%b0%e5%88%b0 aria-label="市面上有哪些 LoongArch 硬件可以买到？">市面上有哪些 LoongArch 硬件可以买到？</a></li>
<li>
<a href=#%e6%80%8e%e4%b9%88%e8%ae%a4%e8%af%86%e5%85%b6%e4%bb%96-loongarch-%e5%90%8c%e5%a5%bd aria-label="怎么认识其他 LoongArch 同好？">怎么认识其他 LoongArch 同好？</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2>
<p>自从 2021 年 LoongArch 架构官宣以来，这个架构获得了与其年龄和市场规模不成比例的关注（此处为褒义）。
但与国内外社会舆论、世界开源社区的热情相对比之下，这个架构的网上公开信息却大部分来自龙芯公司的公关宣传稿；
这可能对主要工作是开会、签字、画饼、圈钱的那些人已经足够了，但对那些要干活的广大开发者却远远不够。</p>
<p>本文就争取做这么一篇讲述客观事实，对开发者有用的 FAQ 文档。
由于涉及商业利益的事物不可避免存在争议，本文也力争将多方观点同时整理、平等呈现。</p>
<p>本文内容会不定期更新，所有更新内容都会注明更新日期。您当前看到的版本是 2022-02-12 更新的。</p>
<p>免责说明：除观点性质的文字之外，本文中体现的信息均取自公开资料。观点性质的文字总会被明确标注出来。
这些观点性质的文字仅代表个人观点，与本人雇主、龙芯公司等实体均无关。
本人与龙芯生态、MIPS 生态的任何企业均无关联。</p>
<h2 id=更新记录>更新记录<a hidden class=anchor aria-hidden=true href=#更新记录>#</a></h2>
<ul>
<li>2022-02-12: 最初版本。</li>
</ul>
<h2 id=关于指令集>关于指令集<a hidden class=anchor aria-hidden=true href=#关于指令集>#</a></h2>
<h3 id=loongarch-是什么中文名叫啥>LoongArch 是什么？中文名叫啥？<a hidden class=anchor aria-hidden=true href=#loongarch-是什么中文名叫啥>#</a></h3>
<blockquote>
<p>龙芯架构 LoongArch 是一种精简指令集计算机（Reduced Instruction Set Computing，简称 RISC）风格的指令系统架构。</p>
<p>——《龙芯架构参考手册》卷一：基础架构，引言</p>
</blockquote>
<p>LoongArch 是龙芯公司设计的一种 CPU 指令集架构，2020 年对外公开其存在，2021 年起公开出货，在其 3A5000 CPU 产品开始搭载。</p>
<p>根据 LoongArch 的参考手册标题以及手册的第一句（引文即为此），LoongArch 的中文名应为“龙芯架构”。</p>
<h3 id=loongarch-有-logo-吗>LoongArch 有 logo 吗？<a hidden class=anchor aria-hidden=true href=#loongarch-有-logo-吗>#</a></h3>
<p>根据现有资料，没有；注册商标的图样是纯文本。</p>
<p>其实比较奇怪，因为一个好的 logo 显然有助于品牌传播。希望 2022 年可以看到一个！</p>
<h3 id=loongarch-这个单词的词源是啥怎么发音>LoongArch 这个单词的词源是啥，怎么发音？<a hidden class=anchor aria-hidden=true href=#loongarch-这个单词的词源是啥怎么发音>#</a></h3>
<p>（注意：此处使用的英语为美式发音。）</p>
<p>显然，该单词是“龙芯”（Loongson）、“Architecture”两个单词的混成词（portmanteau，也叫“混合词”、“合音词”等等）。</p>
<p>介于此，LoongArch 发音也应当是“龙芯”和“Architecture”两词的混合，即 /ˈlʊŋ˧˥/ + /ɑɹk/ = /ˈlʊŋ˧˥ˌɑɹk/（读若“龙Arch”；中式英语发音 lóng à ke，“龙啊（四声）克”）。</p>
<p>当然，实践中“Arch”可能也被直接拼读为/ɑɹt͡ʃ/（作“拱门”解的 arch 一词），其原因与“char”经常不被念为“car”类似。这也是可接受的读音。（中式英语发音 lóng à qu，“龙啊去”） 😏</p>
<h3 id=loongarch-作为一个指令集的基本特征如何>LoongArch 作为一个指令集的基本特征如何？<a hidden class=anchor aria-hidden=true href=#loongarch-作为一个指令集的基本特征如何>#</a></h3>
<p>LoongArch 是一门：</p>
<ul>
<li>支持 32 位、64 位操作的，</li>
<li>仅支持小端（Little-endian）字节序的，</li>
<li>指令字定长 32 位的，</li>
<li>寄存器-寄存器架构。</li>
</ul>
<p>其他一些可通过观察得到的结论：</p>
<p><strong>LoongArch 的操作码全部从最高位向低位延伸，也就是“前缀编码”。</strong> 这有助于节约指令字空间。当然，这意味着 LoongArch 表面上没有明确的“操作码”字段，虽然每个指令的高 6 位也是相当能体现指令功能分类的，仅此而已。</p>
<p><strong>LoongArch 是相当经典的 RISC 架构。</strong> 32 个寄存器，0 号寄存器固定表示零，目标寄存器可以不是源寄存器之一，运算操作不访存，内存模型平坦，等等。</p>
<p><strong>LoongArch 的一些操作比 MIPS 和 RISC-V 更带劲。</strong> 跳转指令和 PIC 相关操作的立即数非常宽；装载立即数至多需要 4 条指令不需要移位；ABI 甚至给未来保留了一个静态寄存器（callee-save register）剩下的也差不多够用。</p>
<h4 id=基本操作的宽度定义>基本操作的宽度定义<a hidden class=anchor aria-hidden=true href=#基本操作的宽度定义>#</a></h4>
<p>在基本操作的宽度定义上，LoongArch 遵循传统架构（如 x86、MIPS）做法：对于多数操作而言，某个特定操作码的宽度不随微架构、当前机器模式确定的寄存器宽度而改变。例如，使用 <code>add.d</code> 操作码的指令要么在当前模式或处理器核上非法，要么永远代表 64 位加法。</p>
<p>注意这与 RISC-V 的做法不同：仍以加法操作为例，RISC-V 的 <code>add</code> 指令总是操作 XLEN 宽度，在 RV32 核上操作 32 位宽，在 RV64 核上就操作 64 位了。相应地，RV64 新增的 <code>addw</code> 指令只操作低 32 位，而这条指令在 RV32 不存在。</p>
<h3 id=la464-处理器核微架构和-gs464v-是不是一个东西为啥改名了>LA464 处理器核/微架构和 GS464V 是不是一个东西，为啥改名了？<a hidden class=anchor aria-hidden=true href=#la464-处理器核微架构和-gs464v-是不是一个东西为啥改名了>#</a></h3>
<p><strong>本回答含有猜测成分。</strong></p>
<p>首先需要明确一点，龙芯公司对其微架构/处理器核的命名似乎没有特别的讲究。
例如，3A4000 处理器包含 4 个 GS464V 核，但几年前的 3B1500 处理器，在文档上它的核也叫 GS464V。
（维基百科上有 GS464EV 的说法，这就是社区为了解除歧义而不得不生造的名字。）</p>
<p>在网上一些较早的公开发表文章和讲演中，主要是一些讲述 3A5000 和 LoongArch 开发过程的内容，可以看到
“调整现有 IP 核的指令系统”等类似的文字。考虑到 3A4000 到 3A5000 是一个 tock-tick 周期，
这似乎意味着 3A4000 换掉译码器就约等于 3A5000。
然而事实上指令集已经不兼容了，共用一个代号终归不好；龙芯公司最终还是在 2021 年 8 月份修改了所有手册与开源代码，
将 GS464V 批量替换为 LA464。</p>
<p>整体上看，LA464 和 GS464V 应该还是理解为大体相同的微架构，但支持指令集不同的一对不太相似的“双胞胎”为好。</p>
<h3 id=loongarch-和-mips-有什么关系>LoongArch 和 MIPS 有什么关系？<a hidden class=anchor aria-hidden=true href=#loongarch-和-mips-有什么关系>#</a></h3>
<p>（请注意：由于所做的事情都是“通用计算”这一件事，所有 RISC 架构都存在相当程度的相似性。）</p>
<p>按照公开资料，LoongArch 与 MIPS 不存在互操作性，并且一些关键架构特性也不能做到 1:1 对应。</p>
<ul>
<li>LoongArch 指令编码与 MIPS 完全不同。</li>
<li>LoongArch 不存在跳转延迟槽（branch delay slots），而 MIPS 直到 R6 才增加了可选使用的无延迟槽跳转指令。</li>
<li>LoongArch 去掉了 MIPS 上的一部分历史包袱，例如神奇的 HI/LO 累加器。</li>
<li>LoongArch 的 ABI 完全离开 MIPS 传统，而基于 RISC-V ABI 定义。分立的返回值寄存器、内核专用寄存器等概念都被摈弃。</li>
</ul>
<p>但客观上从 LoongArch 上确实可以看到明显的 MIPS 影响，例如：</p>
<ul>
<li>LoongArch 特权架构部分与 MIPS 有所相似（例如 TLB 的奇偶页设计，麻烦，不见于其他架构，但 LoongArch 这么做了）。</li>
<li>个别一些指令（如 <code>maskeqz/masknez</code>）与 MIPS R6 对应指令（<code>selnez/seleqz</code>）语义相同，且不见于其他架构。</li>
<li>个别一些操作（如 64 位立即数的装载，分四段，官方指令名为 <code>lu12i.w/ori/lu32i.d/lu52i.d</code>）与 MIPS R6 类似（<code>lui/ori/ahi/ati</code>），仅细节不同（每段的宽度，LoongArch <code>12/20/20/12</code> vs MIPS R6 <code>16/16/16/16</code>）；此做法不见于其他架构。</li>
<li>虚拟化扩展（Loongson Virtualization Extension）的缩写叫 LVZ，非常可疑。因为按照 Loongson SIMD Extension = LSX，Loongson Advanced SIMD Extension = LASX，Loongson Binary Translation Extension = LBT（不对称：没叫 LBTX）的规律，这个扩展应该缩写叫 LVX 或者 LV，无论如何不可能从第二个单词取出两个字母变成 LVZ。VZ 是 MIPS 的叫法！</li>
</ul>
<h3 id=loongarch-和-risc-v-有什么关系>LoongArch 和 RISC-V 有什么关系？<a hidden class=anchor aria-hidden=true href=#loongarch-和-risc-v-有什么关系>#</a></h3>
<p>（请注意：由于所做的事情都是“通用计算”这一件事，所有 RISC 架构都存在相当程度的相似性。）</p>
<p>按照公开资料，LoongArch 与 RISC-V 不存在互操作性，虽然许多指令在一定条件下（如限定 64 位操作）可以做到 1:1 对应。</p>
<ul>
<li>LoongArch 特权架构、内存管理与 RISC-V 相当不同。</li>
<li>LoongArch 基础指令集支持的操作基本是 RISC-V 相应部分的超集。</li>
<li>RISC-V 的带立即数指令，立即数总是做符号扩展，而 LoongArch 有区分（算术操作做符号扩展，逻辑操作做零扩展）。</li>
</ul>
<p>在 LoongArch 的软件部分，如 ABI 和一些基础工具链组件，可以明显看到 RISC-V 的影响。
LoongArch ABI 与 RISC-V ABI 相当相似，且指令语义相似度也高，在进行基础软件移植时，对 RISC-V 汇编代码经常只需做简单语法层面调整即可正确完成 LoongArch 版的相应操作。</p>
<p>LoongArch 的一些指令与对应的 RISC-V 指令语义完全相同，一些架构特性也类似。如：</p>
<ul>
<li>PIC 操作指令 <code>pcaddu12i</code> 与 RISC-V <code>auipc</code> 语义相同。</li>
<li>寄存器跳转指令 <code>jirl</code> 与 RISC-V <code>jalr</code> 语义相同，而与 MIPS <code>jalr</code> 非常不同。</li>
<li>计时指令 <code>rdtime.*</code> 与 RISC-V 相应指令语义类似，都基于恒定频率计时器。</li>
<li>LoongArch（实际从前身 3A4000 就开始了）特权资源位于 CSR 空间，CSR 概念显然来自 RISC-V。</li>
<li>RISC-V 最早有四层权限（从高到低 Machine/Hypervisor/Supervisor/User，后来 Hypervisor 被移除），LoongArch 也定义了四层（从高到低 PLV0/PLV1/PLV2/PLV3）。但 LoongArch 操作系统跑在 PLV0 最高级，而 RISC-V 操作系统建议是跑在 Supervisor 级别。</li>
</ul>
<p>这些也可能是 RISC-V 对 LoongArch 的影响体现。</p>
<h3 id=loongarch-有哪些-abi>LoongArch 有哪些 ABI？<a hidden class=anchor aria-hidden=true href=#loongarch-有哪些-abi>#</a></h3>
<p>按照<a href=https://loongson.github.io/LoongArch-Documentation/LoongArch-ELF-ABI-CN.html>龙芯架构 ELF psABI 文档</a>，LoongArch 目前定义了 3x2=6 种 ABI。</p>
<p>其中数据模型为：</p>
<ul>
<li>ILP32（<code>int</code>、<code>long</code>、指针都为 32 位宽，是 32 位但不彻底排斥 64 位操作的模型）</li>
<li>LP64（<code>long</code> 及更宽的类型与指针为 64 位宽，是 Linux 世界通行的 64 位数据模型）</li>
</ul>
<p>浮点支持为：</p>
<ul>
<li>软浮点（S）</li>
<li>单精度（F）</li>
<li>双精度（D）</li>
</ul>
<p>目前只有 LP64D 一种 ABI 有完整的支持。目前市面上已公开的商业发行版只使用这一种 ABI 构建。
如果您尝试使用其他 ABI，有极大可能会遇到各种编译错误，不建议在生态建设的早期使用。
特别地，ILP32 系列 ABI 的支持非常不完整，如果尝试使用，大概率会直接报错。</p>
<h3 id=loongarch-的向量扩展是怎么一回事>LoongArch 的向量扩展是怎么一回事？<a hidden class=anchor aria-hidden=true href=#loongarch-的向量扩展是怎么一回事>#</a></h3>
<p><strong>由于相关文档没有开放，以下内容是猜测。</strong></p>
<p>MIPS 时代末期的龙芯 3A4000 实现的是完整的 MIPS MSA 向量扩展。
除此之外，3A4000 还支持从 2F 时代继承的 LoongMMI，以及从未在公开文档出现的 LSX/LASX。
梳理这些向量支持：</p>
<ul>
<li>MSA：根据 <a href=https://s3-eu-west-1.amazonaws.com/downloads-mips/documents/MD00868-1D-MSA64-AFP-01.12.pdf>MSA64 手册 v1.12</a> 的描述，是 128 位固定向量宽度。</li>
<li>LoongMMI：用法极度类似 x86 MMX，64 位固定向量宽度。</li>
<li>LSX/LASX：除 PPT 之外公开资料近似不存在，工具链源码短暂出现后被撤回。LSX 应该是 128 位固定向量宽度，LASX 则为 256 位固定向量宽度。</li>
</ul>
<p>可见所有这些向量支持都是固定宽度的。结合《龙芯架构参考手册》卷一 表 2-2“CPUCFG 访问配置信息列表”对
<code>LSX</code>、<code>LASX</code> 位的描述（“128 位向量扩展”、“256 位向量扩展”），可以推测 LoongArch 的
LSX/LASX 和 MIPS 时代的 LSX/LASX 应该是近似的东西，至少向量宽度也是固定的。
指令编码必然改变了，也可能有些指令被增删或修改，毕竟没有公开文档和开源支持，外界不会有代码依赖这些指令，也就不需要考虑兼容性。</p>
<p>注意到近年新兴的向量扩展，如 AArch64 的 SVE 与 RISC-V 的 RVV 都是变长向量，支持软件在运行时动态配置向量单元使其操作宽度适应软件需求，也意味着硬件升级不需要相应修改软件即可透明地利用更宽的硬件资源，是一个较好的趋势。
我们在龙芯的 glibc 代码库中，注意到了<a href=https://github.com/loongson/glibc/commit/02cae44d5f05a06cba72458cf33d4a21b3813e3c>提前为变长向量做准备的变更</a>。
考虑到 LSX/LASX 迟迟未能公布可能有多方面原因（尤其不能排除知识产权问题），这或许意味着 LSX/LASX
将永远不会公开，而在将来的某个时间点会有类似 RVV 的向量指令替代 LSX/LASX 供世界使用。</p>
<h3 id=loongarch-的二进制翻译扩展是怎么一回事>LoongArch 的二进制翻译扩展是怎么一回事？<a hidden class=anchor aria-hidden=true href=#loongarch-的二进制翻译扩展是怎么一回事>#</a></h3>
<p><strong>由于相关文档没有开放，以下内容是猜测。</strong></p>
<p>与向量扩展的情况类似，我们可以参考 MIPS 时代龙芯的二进制翻译扩展来推测 LoongArch 的相应情况。
虽然公开渠道没有指令编码和内核支持，但这个扩展在一些<a href=https://www.slideshare.net/syuu1228/hardware-assited-x86-emulation-on-godson-3-5040660>学术汇报</a>、乃至<a href=https://www.bilibili.com/video/BV1KZ4y1c7kQ>龙芯自己做的展示</a>中已经初见端倪：</p>
<ul>
<li>新增了架构状态 EFLAGS 寄存器，为一些基础指令新增只按照相应语义更新 EFLAGS 的对应指令</li>
<li>新增了架构状态 TOP 寄存器，以及对应的 FPU 模式位，在 x87 模式下，改变浮点操作寄存器字段的语义，使其变为基于 TOP 的寻址方式</li>
</ul>
<p>后来又添加了 ARM 条件执行等操作的支持，想必也是类似的实现思路。那么 LoongArch 的 x86、ARM
二进制翻译大概率也是先前二进制翻译扩展的微调；至于 MIPS 二进制翻译，由于同属经典 RISC 架构，
可能唯一的硬件支持会是跳转延迟槽。（HI/LO 等其他一些奇葩 MIPS 特性可以在翻译阶段由软件轻易完成，反正也要重建数据流。）</p>
<h2 id=关于开发>关于开发<a hidden class=anchor aria-hidden=true href=#关于开发>#</a></h2>
<h3 id=我准备移植我的软件到-loongarch有什么需要准备的吗>我准备移植我的软件到 LoongArch，有什么需要准备的吗？<a hidden class=anchor aria-hidden=true href=#我准备移植我的软件到-loongarch有什么需要准备的吗>#</a></h3>
<p><strong>您不需要特别准备！</strong></p>
<p>LoongArch 生态建设的预期是成为一个“正常”的软硬件平台。
您怎么为其他平台（如 x86、ARM）做开发，除了那些本质上就与平台相关的事情之外，在 LoongArch 上您就怎么做。</p>
<p>如果您使用高级语言进行具体领域的业务研发，您大体上总是不需要关注平台底层的技术细节。
这些事情已经主要由开源社区（包括全世界使用龙芯的企业和个人开发者）完成了。</p>
<p>如果您本身即是基础软件的开发者，或者属于需要偶尔关注底层技术细节的上层开发者，
龙芯公司提供的<a href=https://loongson.github.io/LoongArch-Documentation>龙芯架构文档</a>是很好的出发点。</p>
<h3 id=我用-cc-语言怎么写-cflags怎么针对-loongarch-及其基础特性做条件编译>我用 C/C++ 语言，怎么写 CFLAGS？怎么针对 LoongArch 及其基础特性做条件编译？<a hidden class=anchor aria-hidden=true href=#我用-cc-语言怎么写-cflags怎么针对-loongarch-及其基础特性做条件编译>#</a></h3>
<p>请参阅<a href=https://loongson.github.io/LoongArch-Documentation/LoongArch-toolchain-conventions-CN.html>《龙芯架构工具链约定》</a>。</p>
<h3 id=我没有-loongarch-硬件我的软件该怎么测试>我没有 LoongArch 硬件，我的软件该怎么测试？<a hidden class=anchor aria-hidden=true href=#我没有-loongarch-硬件我的软件该怎么测试>#</a></h3>
<p>大部分情况下，您可以使用 QEMU 完成测试。
系统级模拟（模拟一台完整的龙芯架构计算机）与用户态模拟（将当前系统的内核模拟为龙芯架构）均可以支持。
QEMU 的使用方法不属于本文范畴，请参考其他在线资料。</p>
<p>注：截至 2022-02-12，LoongArch 的 target 支持没有合入 QEMU 主线，这意味着您需要自行编译<a href=https://github.com/loongson/qemu/tree/tcg-dev>龙芯的开发分支</a>。</p>
<h2 id=关于生态>关于生态<a hidden class=anchor aria-hidden=true href=#关于生态>#</a></h2>
<h3 id=有哪些-linux-发行版提供-loongarch-支持了>有哪些 Linux 发行版提供 LoongArch 支持了？<a hidden class=anchor aria-hidden=true href=#有哪些-linux-发行版提供-loongarch-支持了>#</a></h3>
<p>得益于龙芯公司优先提供的硬件与团队协作等资源，LoongArch 的商业生态建设非常迅速。</p>
<p>截至 2022-02-12，已有多种（中国大陆境内的）商业 Linux 发行版提供了 LoongArch port，包括但不限于以下的发行版（按字母顺序排列）：</p>
<ul>
<li>Kylin（麒麟）</li>
<li>Loongnix（龙芯中科）</li>
<li>UOS（统信）</li>
</ul>
<p>在 LoongArch 指令集手册等文档发布、以及工具链等基础软件的分支（fork）开源后，社区发行版也加快了移植的脚步。
截至 2022-02-12 已经出现了以下的发行版移植项目（包括但不限于，字母顺序排列）：</p>
<ul>
<li>Arch Linux</li>
<li>CLFS</li>
<li>Gentoo</li>
</ul>
<h3 id=为什么我不能在社区发行版上运行-wps-office-等软件旧世界新世界是怎么一回事>为什么我不能在社区发行版上运行 WPS Office 等软件？（“旧世界”“新世界”是怎么一回事？）<a hidden class=anchor aria-hidden=true href=#为什么我不能在社区发行版上运行-wps-office-等软件旧世界新世界是怎么一回事>#</a></h3>
<p>截至 2022-02-12，所有商业发行版与所有社区发行版互不兼容。
社区发行版上构建的所有二进制软件，以及部分以源码、字节码形式存在的高级语言软件（如 Python、Java 写作的软件）不能在商业发行版上运行，反之亦然。
目前第三方软件开发商提供的闭源软件（如 WPS Office 等）都是在商业发行版上构建的，在社区发行版上有极大的概率不能工作。</p>
<p>这个情况一般被称作 <strong>“新旧世界”的兼容问题</strong>。目前所有商业发行版都属于旧世界，所有社区发行版都属于新世界。两个世界在未来会得到统一，但目前可以被视作两个平行宇宙。</p>
<p>至于为何会出现两个世界，以及有哪些方法可以做到兼容，就说来话长了 ;-) 所有细节会在不久后的另一篇文章中专门讲述。</p>
<h3 id=市面上有哪些-loongarch-硬件可以买到>市面上有哪些 LoongArch 硬件可以买到？<a hidden class=anchor aria-hidden=true href=#市面上有哪些-loongarch-硬件可以买到>#</a></h3>
<p>虽然龙芯产品的国际购买渠道自从 2F 时代之后就已基本不复存在，但至少在中国大陆地区，已经有多种搭载
LoongArch CPU 的产品可以在公开渠道方便地买到。
例如，龙芯 3A5000 有 ATX 主板、整机、笔记本形态的产品，3C5000L 有机架式服务器形态的产品。</p>
<p>由于涉及商业，本文不便提供任何具体的购买渠道或链接，但您总可以自行在某宝、某东、某鱼等平台上搜索“龙芯”关键词。</p>
<p>注意：由于目前龙芯产品产量较小，无法靠规模效应摊薄成本，这些产品会比各项指标近似的 x86、ARM 等“主流”产品贵上许多。加之生态建设早期会有许多基础性的问题亟待解决，因此 <strong>不建议只想买来使用的非开发者用户冲动购买</strong>。</p>
<h3 id=怎么认识其他-loongarch-同好>怎么认识其他 LoongArch 同好？<a hidden class=anchor aria-hidden=true href=#怎么认识其他-loongarch-同好>#</a></h3>
<p>所有技术都有交流社区，LoongArch 当然不例外。网上有许多地方都可以讨论龙芯、LoongArch 等等相关话题，人多的公开场合包括但不限于：</p>
<ul>
<li><a href=http://bbs.loongnix.cn/>龙芯开源社区论坛</a>（由于技术原因，目前不支持 HTTPS）（仅中文交流）</li>
<li><a href="https://tieba.baidu.com/f?kw=%E9%BE%99%E8%8A%AF&ie=utf-8">百度贴吧龙芯吧</a>（仅中文交流）</li>
<li><a href=https://t.me/loongson_users>Telegram Loongson group</a>（中文 & English）</li>
</ul>
<p>有一些龙芯话题的 QQ 群，但由于本文作者不使用 QQ，因此不知道群号。（欢迎知道的朋友给作者私聊或者提 PR 补充！）</p>
<p>注：这些公开场合相比技术交流更适合灌水。
由于围绕龙芯有一群观念较为极端的最终用户粉丝，就事论事的技术交流万一涉及一些敏感话题点，在以上公开场合不一定会有效率。
但如果您具备相应的技术交流态度、技能，您应该自己也能找到开发者的交流场所，因此此处就暂时不提供了 ;-)</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=next href=https://blog.xen0n.name/posts/writing/2022-revamp-and-devirtualization/>
<span class=title> »</span>
<br>
<span>2022：翻新，脱虚向实</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>© WANG Xuerui; 以 cc-by-nc-sa 4.0 授权</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>