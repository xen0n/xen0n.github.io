<!doctype html><html lang=zh-cmn-hans-cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CyanogenMod for 魅族 MX4: 常见问题解答 #1 | write(2)</title><meta name=keywords content><meta name=description content="BL 锁规避进度 你应该已经知道了, 安卓版的 MX4 有 BL 锁, 只能跑 Flyme. 由于 MTK 的安全受限引导特性, 有分区通不过 RSA 签名校验的话, 手机会硬变砖, 充电都充不进去,"><meta name=author content="WÁNG &#34;xen0n&#34; Xuěruì"><link rel=canonical href=https://blog.xen0n.name/posts/old/meizu-mx4-cm/faq/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.xen0n.name/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.xen0n.name/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.xen0n.name/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.xen0n.name/apple-touch-icon.png><link rel=mask-icon href=https://blog.xen0n.name/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cmn-hans-cn href=https://blog.xen0n.name/posts/old/meizu-mx4-cm/faq/><link rel=alternate hreflang=en href=https://blog.xen0n.name/en/posts/old/meizu-mx4-cm/faq/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="CyanogenMod for 魅族 MX4: 常见问题解答 #1"><meta property="og:description" content="BL 锁规避进度 你应该已经知道了, 安卓版的 MX4 有 BL 锁, 只能跑 Flyme. 由于 MTK 的安全受限引导特性, 有分区通不过 RSA 签名校验的话, 手机会硬变砖, 充电都充不进去,"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.xen0n.name/posts/old/meizu-mx4-cm/faq/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-09-14T17:00:00+08:00"><meta property="article:modified_time" content="2015-09-14T17:00:00+08:00"><meta property="og:site_name" content="write(2)"><meta name=twitter:card content="summary"><meta name=twitter:title content="CyanogenMod for 魅族 MX4: 常见问题解答 #1"><meta name=twitter:description content="BL 锁规避进度 你应该已经知道了, 安卓版的 MX4 有 BL 锁, 只能跑 Flyme. 由于 MTK 的安全受限引导特性, 有分区通不过 RSA 签名校验的话, 手机会硬变砖, 充电都充不进去,"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.xen0n.name/posts/"},{"@type":"ListItem","position":2,"name":"CyanogenMod for 魅族 MX4: 常见问题解答 #1","item":"https://blog.xen0n.name/posts/old/meizu-mx4-cm/faq/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CyanogenMod for 魅族 MX4: 常见问题解答 #1","name":"CyanogenMod for 魅族 MX4: 常见问题解答 #1","description":"BL 锁规避进度 你应该已经知道了, 安卓版的 MX4 有 BL 锁, 只能跑 Flyme. 由于 MTK 的安全受限引导特性, 有分区通不过 RSA 签名校验的话, 手机会硬变砖, 充电都充不进去,","keywords":[],"articleBody":"BL 锁规避进度 你应该已经知道了, 安卓版的 MX4 有 BL 锁, 只能跑 Flyme. 由于 MTK 的安全受限引导特性, 有分区通不过 RSA 签名校验的话, 手机会硬变砖, 充电都充不进去, 因为锁执行得比其他组件的初始化都早. 而且因为引导 ROM (BROM) 是硬件层面上锁的, 用 SP Flash Tools 也不能救砖.\n尽管如此, 我们还是可以往 MX4 上移植第三方安卓系统. 这里我们要感谢魅族的工程师, Flyme 的启动过程没有与 AOSP 产生太大差异, 这意味着我们可以混搭 Flyme 的 boot 分区和第三方的 system 分区 (尽管会失去一些功能, 比如需要修改 init 脚本的功能).\n另一种思路是向原版内核移植 kexec 功能, 在原版内核载入后, 以它为跳板, 接着载入一个相同的内核和我们的 initramfs. 因为魅族没有将内核开源, 所以我们只能用相同的内核, 然而他们并没有关掉内核的模块支持, 这很关键.\n目前进度:\n  不可行: 不要尝试 用从 Ubuntu 版提取的分区映像直接刷掉对应分区\n preloader (/dev/block/mmcblk0boot0) lk seccfg secro flashinfo  这种思路尽管理论上完全可行 (因为它 看起来 换掉了引导过程涉及的所有代码), 实际上还是会硬变砖, 这可能是因为我们从 Linux 无法访问到 BROM, 而其中存放了另外一部分的加密信息. 访问 BROM 的唯一方法也许是特殊的硬件调试设备, 然而获取这种设备并做破解工作可能有法律风险. 我测试这个思路前后砖了两台微博招募的小白鼠机器, 所以劝各位不要尝试. 我要让你们知道我刷了是这个样子, 你们刷了也是这个样子 (作劈砖状)\n  可行: 修改系统底层使其能在 MTK/Flyme boot.img 上完成引导\n这个思路主要就是观察 AOSP 和 MTK 的 boot.img 组件 (init, init 脚本和 healthd 等等) 在行为上的差异, 并且在我们可以自由修改的系统代码中弥补这种差异. 然而因为 boot.img 我们并没有去修改, 有些功能会比较难实现, 尤其是依赖 init 服务的功能. 比方说 CM 的超级用户权限管理就是一个十分明显的例子, 所有刷了第一版封测包的小白鼠都失去了 root 权限, 然而我甚至明确启动了 su 服务! (通过一个以 root 身份运行而在 CM 上不存在的服务.)\n因为这个思路要求修改系统底层, 也不是很优雅, 所以我们有第三个思路 –\n  未知: kexec 另一个内核换掉 initramfs\n我在 XDA 上找到了一个实现, 然而它貌似是基于 Code Aurora Forum (一个高通维护的分支) 的 3.4 版本内核构建的, 在我们的 MTK 3.10 内核上完全就不能用. 一大波代码之后模块终于能成功编译并载入了, 然后内核跟着也 panic 了. 接下来的几天我尝试基于开源的 MX4 Ubuntu 版内核代码从头进行这个思路, 看看到底可不可行.\n  安卓版 MX4 刷 Ubuntu Touch 的可行性 Ubuntu 版 MX4 的 lk 比安卓版的要多传几个内核参数. 你可能觉得这无所谓, 然而这几个参数是这样的:\nsystempart=/dev/disk/by-partlabel/system datapart=/dev/disk/by-partlabel/userdata fixrtc (系统分区=... 数据分区=... 修复硬件时钟) 额…\n不光是 lk 差异, Ubuntu Touch 还有自己不同的内核和启动序列, 想在安卓版 MX4 上启动它实质上就相当于要求我们破掉 BL!\n哎… 反正如果 kexec 绕过 BL 的方案成功的话, Ubuntu Touch 就能移植到安卓版 MX4, 否则的话恐怕就有点困难了.\nYunOS 版 MX4 的兼容性 硬件几乎是一样的, 这个问题从一开始就不存在… 然而有听说 YunOS 版和通用版 Flyme 互刷变砖的事例, 我不能 100% 确信两个版本是兼容的, 还需要进一步研究.\n","wordCount":"1179","inLanguage":"zh-cmn-hans-cn","datePublished":"2015-09-14T17:00:00+08:00","dateModified":"2015-09-14T17:00:00+08:00","author":[{"@type":"Person","name":"WÁNG \"xen0n\" Xuěruì"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.xen0n.name/posts/old/meizu-mx4-cm/faq/"},"publisher":{"@type":"Organization","name":"write(2)","logo":{"@type":"ImageObject","url":"https://blog.xen0n.name/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.xen0n.name/ accesskey=h title="write(2) (Alt + H)">write(2)</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.xen0n.name/en/ title="English (US)" aria-label=:us:>🇺🇸</a></li></ul></span></div><ul id=menu><li><a href=https://blog.xen0n.name/archives title=所有文章><span>所有文章</span></a></li><li><a href=https://blog.xen0n.name/%E6%96%87%E7%AB%A0%E7%B1%BB%E5%88%AB title=文章类别><span>文章类别</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.xen0n.name/>主页</a>&nbsp;»&nbsp;<a href=https://blog.xen0n.name/posts/>Posts</a></div><h1 class=post-title>CyanogenMod for 魅族 MX4: 常见问题解答 #1</h1><div class=post-meta><span title="2015-09-14 17:00:00 +0800 +0800">2015/09/14</span>&nbsp;·&nbsp;预计阅读时间: 3 分钟&nbsp;·&nbsp;WÁNG "xen0n" Xuěruì&nbsp;|&nbsp;<ul class=i18n_list>其他语言版本:<li><a href=https://blog.xen0n.name/en/posts/old/meizu-mx4-cm/faq/>🇺🇸</a></li></ul></div></header><div class=post-content><h2 id=bl-锁规避进度>BL 锁规避进度<a hidden class=anchor aria-hidden=true href=#bl-锁规避进度>#</a></h2><p>你应该已经知道了, 安卓版的 MX4 有 BL 锁, 只能跑 Flyme. 由于 MTK
的<s>安全</s>受限引导特性, 有分区通不过 RSA 签名校验的话, 手机会硬变砖,
充电都充不进去, 因为锁执行得比其他组件的初始化都早. 而且因为引导 ROM (BROM)
是硬件层面上锁的, 用 SP Flash Tools 也不能救砖.</p><p>尽管如此, 我们还是可以往 MX4 上移植第三方安卓系统. 这里我们要感谢魅族的工程师,
Flyme 的启动过程没有与 AOSP 产生太大差异, 这意味着我们可以混搭 Flyme 的 <code>boot</code>
分区和第三方的 <code>system</code> 分区 (尽管会失去一些功能, 比如需要修改 init 脚本的功能).</p><p>另一种思路是向原版内核移植 <code>kexec</code> 功能, 在原版内核载入后, 以它为跳板,
接着载入一个相同的内核和我们的 initramfs. 因为魅族没有将内核开源,
所以我们只能用相同的内核, 然而他们并没有关掉内核的模块支持, 这很关键.</p><p>目前进度:</p><ul><li><p>不可行: <strong>不要尝试</strong> 用从 Ubuntu 版提取的分区映像直接刷掉对应分区</p><ul><li><code>preloader</code> (<code>/dev/block/mmcblk0boot0</code>)</li><li><code>lk</code></li><li><code>seccfg</code></li><li><code>secro</code></li><li><code>flashinfo</code></li></ul><p>这种思路尽管理论上完全可行 (因为它 <strong>看起来</strong> 换掉了引导过程涉及的所有代码),
实际上还是会硬变砖, 这可能是因为我们从 Linux 无法访问到 BROM,
而其中存放了另外一部分的加密信息. 访问 BROM 的唯一方法也许是特殊的硬件调试设备,
然而获取这种设备并做破解工作可能有法律风险.
我测试这个思路前后砖了两台微博招募的小白鼠机器, 所以劝各位不要尝试.
我要让你们知道我刷了是这个样子, 你们刷了也是这个样子 (作劈砖状)</p></li><li><p>可行: 修改系统底层使其能在 MTK/Flyme <code>boot.img</code> 上完成引导</p><p>这个思路主要就是观察 AOSP 和 MTK 的 <code>boot.img</code> 组件 (<code>init</code>, init 脚本和
<code>healthd</code> 等等) 在行为上的差异, 并且在我们可以自由修改的系统代码中弥补这种差异.
然而因为 <code>boot.img</code> 我们并没有去修改, 有些功能会比较难实现, 尤其是依赖
<code>init</code> 服务的功能. 比方说 CM 的超级用户权限管理就是一个十分明显的例子,
所有刷了第一版封测包的小白鼠都失去了 root 权限, 然而我甚至明确启动了 <code>su</code>
服务! (通过一个以 <code>root</code> 身份运行而在 CM 上不存在的服务.)</p><p>因为这个思路要求修改系统底层, 也不是很优雅, 所以我们有第三个思路 &ndash;</p></li><li><p>未知: <code>kexec</code> 另一个内核换掉 initramfs</p><p><a href="http://forum.xda-developers.com/showthread.php?t=2495152">我在 XDA 上找到了一个实现</a>, 然而它貌似是基于 Code Aurora Forum
(一个高通维护的分支) 的 3.4 版本内核构建的, 在我们的 MTK 3.10 内核上完全就不能用.
一大波代码之后模块终于能成功编译并载入了, 然后内核跟着也 panic 了.
接下来的几天我尝试基于开源的 MX4 Ubuntu 版内核代码从头进行这个思路,
看看到底可不可行.</p></li></ul><h2 id=安卓版-mx4-刷-ubuntu-touch-的可行性>安卓版 MX4 刷 Ubuntu Touch 的可行性<a hidden class=anchor aria-hidden=true href=#安卓版-mx4-刷-ubuntu-touch-的可行性>#</a></h2><p>Ubuntu 版 MX4 的 <code>lk</code> 比安卓版的要多传几个内核参数. 你可能觉得这无所谓,
然而这几个参数是这样的:</p><pre tabindex=0><code>systempart=/dev/disk/by-partlabel/system datapart=/dev/disk/by-partlabel/userdata fixrtc

(系统分区=... 数据分区=... 修复硬件时钟)
</code></pre><p>额&mldr;</p><p>不光是 <code>lk</code> 差异, Ubuntu Touch 还有自己不同的内核和启动序列, 想在安卓版 MX4
上启动它实质上就相当于要求我们破掉 BL!</p><p>哎&mldr; 反正如果 <code>kexec</code> 绕过 BL 的方案成功的话, Ubuntu Touch 就能移植到安卓版
MX4, 否则的话恐怕就有点困难了.</p><h2 id=yunos-版-mx4-的兼容性>YunOS 版 MX4 的兼容性<a hidden class=anchor aria-hidden=true href=#yunos-版-mx4-的兼容性>#</a></h2><p>硬件几乎是一样的, 这个问题从一开始就不存在&mldr; 然而有听说 YunOS 版和通用版
Flyme 互刷变砖的事例, 我不能 100% 确信两个版本是兼容的, 还需要进一步研究.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.xen0n.name/posts/old/meizu-mx4-cm/cm-12.1-userdebug-1/><span class=title>« 上一页</span><br><span>CyanogenMod for 魅族 MX4: CM12.1 20150921 测试包发布</span></a>
<a class=next href=https://blog.xen0n.name/posts/meta/making-of-this-blog/><span class=title>下一页 »</span><br><span>这个博客是怎样搭建的</span></a></nav></footer><script src=https://utteranc.es/client.js repo=xen0n/xen0n.github.io issue-term=pathname label=comment theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>© WANG Xuerui; 以 cc-by-nc-sa 4.0 授权</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>